<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>desarrollo.views &mdash; sap 3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="sap 3.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../index.html">
          <span>sap 3.0 documentation</span></a></h1>
        <h2 class="heading"><span>desarrollo.views</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for desarrollo.views</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.http.response</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">RequestContext</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">administracion.models</span> <span class="kn">import</span> <span class="n">Proyecto</span><span class="p">,</span> <span class="n">Rol</span><span class="p">,</span> <span class="n">TipoAtributo</span>
<span class="kn">from</span> <span class="nn">desarrollo.models</span> <span class="kn">import</span> <span class="n">Item</span><span class="p">,</span> <span class="n">Fase</span><span class="p">,</span> <span class="n">TipoItem</span><span class="p">,</span> <span class="n">ValorAtributo</span><span class="p">,</span> <span class="n">VersionItem</span>
<span class="kn">from</span> <span class="nn">desarrollo.forms</span> <span class="kn">import</span> <span class="n">CrearItemForm</span><span class="p">,</span> <span class="n">ModificarItemForm</span><span class="p">,</span> <span class="n">CrearFaseForm</span><span class="p">,</span> <span class="n">ModificarFaseForm</span><span class="p">,</span> <span class="n">CrearTipoItemForm</span><span class="p">,</span> <span class="n">ModificarTipoItemForm</span>
<span class="kn">from</span> <span class="nn">inicio.decorators</span> <span class="kn">import</span> <span class="n">permiso_requerido</span><span class="p">,</span> <span class="n">miembro_proyecto</span><span class="p">,</span> <span class="n">fase_miembro_proyecto</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="desarrollo_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.desarrollo_view">[docs]</a><span class="k">def</span> <span class="nf">desarrollo_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del modulo de desarrollo. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">                - El usuario debe estar logueado.</span>
<span class="sd">                </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de los proyectos puestos en marcha.</span>
<span class="sd">        Inicialmente, se verifican los permisos del usuario solicitante para restringir (si es necesario) </span>
<span class="sd">        los botones de accion sobre cada proyecto.</span>
<span class="sd">          </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">                - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">      </span>
<span class="sd">                - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">calcular_costo</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_fases</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Calcular costo de proyecto&#39;</span><span class="p">:</span>
                <span class="n">calcular_costo</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar fases de proyecto&#39;</span><span class="p">:</span>
                <span class="n">gestionar_fases</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="k">if</span> <span class="n">calcular_costo</span> <span class="ow">and</span> <span class="n">gestionar_fases</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">calcular_costo</span> <span class="ow">and</span> <span class="n">gestionar_fases</span><span class="p">:</span>
                <span class="k">break</span>
            
    <span class="n">proyectos</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">estado</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;proyectos&#39;</span><span class="p">:</span> <span class="n">proyectos</span><span class="p">,</span> <span class="s">&#39;calcular_costo&#39;</span><span class="p">:</span><span class="n">calcular_costo</span><span class="p">,</span> <span class="s">&#39;gestionar_fases&#39;</span><span class="p">:</span><span class="n">gestionar_fases</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;desarrollo/desarrollo.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Calcular costo de proyecto&quot;</span><span class="p">)</span>
<span class="nd">@miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="calcular_costo_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.calcular_costo_view">[docs]</a><span class="k">def</span> <span class="nf">calcular_costo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del calculo del costo total de un proyecto. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Calcular costo de proyecto.</span>
<span class="sd">            - Debe ser miembro del proyecto en cuestion.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario conocer el costo total del proyecto seleccionado, para lograr esto, se recorren </span>
<span class="sd">        todas las fases y todos los items, y se suman los costos individuales de cada item hasta terminar el ciclo de </span>
<span class="sd">        recorrido por las fases del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">    </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fases</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">fases_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">costo_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">fases</span><span class="p">:</span>
        <span class="n">fases_valido</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fases</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">items_valido</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                    <span class="n">costo_total</span> <span class="o">=</span> <span class="n">costo_total</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">costo</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;fases_valido&#39;</span><span class="p">:</span><span class="n">fases_valido</span><span class="p">,</span> <span class="s">&#39;items_valido&#39;</span><span class="p">:</span><span class="n">items_valido</span><span class="p">,</span> <span class="s">&#39;costo_total&#39;</span><span class="p">:</span><span class="n">costo_total</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;desarrollo/costo_total.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar fases de proyecto&quot;</span><span class="p">)</span>
<span class="nd">@miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="fases_proyecto_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.fases_proyecto_view">[docs]</a><span class="k">def</span> <span class="nf">fases_proyecto_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de fases por proyecto. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">                - El usuario debe estar logueado.</span>
<span class="sd">                - El usuario debe poseer el permiso: Gestionar fases de proyecto.</span>
<span class="sd">                - Debe ser miembro del proyecto en cuestion.</span>
<span class="sd">        </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de las fases por proyecto.</span>
<span class="sd">        Inicialmente, se verifican los permisos del usuario solicitante para restringir (si es necesario) </span>
<span class="sd">        los botones de accion sobre cada fase.</span>
<span class="sd">                </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">                - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">                - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">                - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">crear_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">modificar_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">eliminar_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">visualizar_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_tipos_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_items</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_roles</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">iniciar_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">finalizar_fase</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Crear fase&#39;</span><span class="p">:</span>
                <span class="n">crear_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Modificar fase&#39;</span><span class="p">:</span>
                <span class="n">modificar_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Eliminar fase&#39;</span><span class="p">:</span>
                <span class="n">eliminar_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Visualizar fase&#39;</span><span class="p">:</span>
                <span class="n">visualizar_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar tipos de item de fase&#39;</span><span class="p">:</span>
                <span class="n">gestionar_tipos_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar roles de fase&#39;</span><span class="p">:</span>
                <span class="n">gestionar_roles</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Iniciar fase&#39;</span><span class="p">:</span>
                <span class="n">iniciar_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Finalizar fase&#39;</span><span class="p">:</span>
                <span class="n">finalizar_fase</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar items de fase&#39;</span><span class="p">:</span>
                <span class="n">gestionar_items</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="k">if</span> <span class="n">crear_fase</span> <span class="ow">and</span> <span class="n">modificar_fase</span> <span class="ow">and</span> <span class="n">eliminar_fase</span> <span class="ow">and</span> <span class="n">visualizar_fase</span> <span class="ow">and</span> <span class="n">gestionar_tipos_item</span> <span class="ow">and</span> <span class="n">gestionar_roles</span> <span class="ow">and</span> <span class="n">iniciar_fase</span> <span class="ow">and</span> <span class="n">finalizar_fase</span> <span class="ow">and</span> <span class="n">gestionar_items</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">crear_fase</span> <span class="ow">and</span> <span class="n">modificar_fase</span> <span class="ow">and</span> <span class="n">eliminar_fase</span> <span class="ow">and</span> <span class="n">visualizar_fase</span> <span class="ow">and</span> <span class="n">gestionar_tipos_item</span> <span class="ow">and</span> <span class="n">gestionar_roles</span> <span class="ow">and</span> <span class="n">iniciar_fase</span> <span class="ow">and</span> <span class="n">finalizar_fase</span> <span class="ow">and</span> <span class="n">gestionar_items</span><span class="p">:</span>
                <span class="k">break</span>
            
    <span class="n">fases</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fases&#39;</span><span class="p">:</span><span class="n">fases</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;crear_fase&#39;</span><span class="p">:</span><span class="n">crear_fase</span><span class="p">,</span> <span class="s">&#39;modificar_fase&#39;</span><span class="p">:</span><span class="n">modificar_fase</span><span class="p">,</span> <span class="s">&#39;eliminar_fase&#39;</span><span class="p">:</span><span class="n">eliminar_fase</span><span class="p">,</span> <span class="s">&#39;visualizar_fase&#39;</span><span class="p">:</span><span class="n">visualizar_fase</span><span class="p">,</span> <span class="s">&#39;gestionar_tipos_item&#39;</span><span class="p">:</span><span class="n">gestionar_tipos_item</span><span class="p">,</span> <span class="s">&#39;gestionar_roles&#39;</span><span class="p">:</span><span class="n">gestionar_roles</span><span class="p">,</span> <span class="s">&#39;iniciar_fase&#39;</span><span class="p">:</span><span class="n">iniciar_fase</span><span class="p">,</span> <span class="s">&#39;finalizar_fase&#39;</span><span class="p">:</span><span class="n">finalizar_fase</span><span class="p">,</span> <span class="s">&#39;gestionar_items&#39;</span><span class="p">:</span><span class="n">gestionar_items</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;desarrollo/gestion_fases.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Crear fase&quot;</span><span class="p">)</span>
<span class="nd">@miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="crear_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.crear_fase_view">[docs]</a><span class="k">def</span> <span class="nf">crear_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para crear una fase dentro de un proyecto. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Crear fase.</span>
<span class="sd">            - Debe ser miembro del proyecto en cuestion.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario crear una fase para lograr esto, se verifica la validez de cada campo ingresado y </span>
<span class="sd">        luego se crea la fase de acuerdo a los campos ingresados. </span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de usuarios. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">CrearFaseForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CrearFaseForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            <span class="n">duracion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;duracion&#39;</span><span class="p">]</span>
            <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;fecha_inicio&#39;</span><span class="p">]</span>
            
            <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">,</span> <span class="n">duracion</span><span class="o">=</span><span class="n">duracion</span><span class="p">,</span> <span class="n">fecha_inicio</span><span class="o">=</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">num_secuencia</span><span class="o">=</span><span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fase</span><span class="p">)</span>
            <span class="n">proyecto</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/crear_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/crear_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Modificar fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="modificar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.modificar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">modificar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para modificar una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Modificar fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario modificar una fase previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica la validez de cada campo modificado y luego se guarda la fase de acuerdo a los campos ingresados.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template de visualizacion de la fase modificada. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarFaseForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            <span class="n">duracion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;duracion&#39;</span><span class="p">]</span>
            <span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;fecha_inicio&#39;</span><span class="p">]</span>
            
            <span class="n">fase</span><span class="o">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="n">descripcion</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">duracion</span> <span class="o">=</span> <span class="n">duracion</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">fecha_inicio</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarFaseForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="p">{</span>
            <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
            <span class="s">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="o">.</span><span class="n">descripcion</span><span class="p">,</span>
            <span class="s">&#39;presupuesto&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="o">.</span><span class="n">duracion</span><span class="p">,</span>
            <span class="p">})</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/modificar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Eliminar fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="eliminar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.eliminar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">eliminar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para eliminar una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Eliminar fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario eliminar una fase previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica si la fase cumple las siguientes condiciones:</span>
<span class="sd">        </span>
<span class="sd">            - La fase debe estar en estado Inactivo.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o no se cumplieron las condiciones para eliminar, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de fases. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valido</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">fases</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__gt</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fases</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/eliminar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/eliminar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Visualizar fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="visualizar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.visualizar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">visualizar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para visualizar una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Visualizar fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario visualizar todos los campos guardados de una fase previamente seleccionada.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/visualizar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="subir_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.subir_fase_view">[docs]</a><span class="k">def</span> <span class="nf">subir_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para subir de secuencia una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario subir el numero de secuencia de una fase y por medio de ello bajar el numero de secuencia de la</span>
<span class="sd">        fase ubicada inmediatamente arriba de la fase seleccionada para subir. Sin embargo, para poder subir el numero de secuencia</span>
<span class="sd">        se deben cumplir los siguientes requisitos:</span>
<span class="sd">            </span>
<span class="sd">            - La fase a subir no debe estar en estado Finalizado y ninguno de sus items debe ser sucesor o antecesor de los items </span>
<span class="sd">            de sus dos fases vecinas (la inmediatamente superior e inferior).</span>
<span class="sd">            - La fase de arriba debe cumplir los mismos requisitos que la fase a subir.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">subir_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">secuencia_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">f_estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">fs_estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">fs_relaciones_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">secuencia_valida</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">f_estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">relaciones</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relaciones</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fase_superior</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num_secuencia</span><span class="o">=</span><span class="p">(</span><span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fase_superior</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fs_estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">fase_superior</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">fase_superior</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fs_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">relaciones</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relaciones</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">fs_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">if</span> <span class="n">f_estado_valido</span> <span class="ow">and</span> <span class="n">fs_estado_valido</span> <span class="ow">and</span> <span class="n">secuencia_valida</span> <span class="ow">and</span> <span class="n">f_relaciones_valida</span> <span class="ow">and</span> <span class="n">fs_relaciones_valida</span><span class="p">:</span>
        <span class="n">fases</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">fase_superior</span> <span class="o">=</span> <span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num_secuencia</span><span class="o">=</span><span class="p">(</span><span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fase</span> <span class="o">=</span> <span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">fase_superior</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="n">fase_superior</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">fase_superior</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">proyecto</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subir_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="bajar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.bajar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">bajar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para bajar de secuencia una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario bajar el numero de secuencia de una fase y por medio de ello subir el numero de secuencia de la</span>
<span class="sd">        fase ubicada inmediatamente abajo de la fase seleccionada para bajar. Sin embargo, para poder bajar el numero de secuencia</span>
<span class="sd">        se deben cumplir los siguientes requisitos:</span>
<span class="sd">            </span>
<span class="sd">            - La fase a bajar no debe estar en estado Finalizado y ninguno de sus items debe ser sucesor o antecesor de los items </span>
<span class="sd">            de sus dos fases vecinas (la inmediatamente superior e inferior).</span>
<span class="sd">            - La fase de abajo debe cumplir los mismos requisitos que la fase a bajar.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - num_secuencia: el numero de secuencia de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">bajar_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">secuencia_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">f_estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">fi_estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">fi_relaciones_valida</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">==</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
        <span class="n">secuencia_valida</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">f_estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">relaciones</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relaciones</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">f_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">&lt;</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
        <span class="n">fase_inferior</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num_secuencia</span><span class="o">=</span><span class="p">(</span><span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fase_inferior</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fi_estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">fase_inferior</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">fase_inferior</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fi_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">relaciones</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relaciones</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">fi_relaciones_valida</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">if</span> <span class="n">f_estado_valido</span> <span class="ow">and</span> <span class="n">fi_estado_valido</span> <span class="ow">and</span> <span class="n">secuencia_valida</span> <span class="ow">and</span> <span class="n">f_relaciones_valida</span> <span class="ow">and</span> <span class="n">fi_relaciones_valida</span><span class="p">:</span>
        <span class="n">fase_inferior</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num_secuencia</span><span class="o">=</span><span class="p">(</span><span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">fase_inferior</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="n">fase_inferior</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">fase_inferior</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">proyecto</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bajar_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">id_proyecto</span><span class="p">)</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar roles de fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="roles_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.roles_fase_view">[docs]</a><span class="k">def</span> <span class="nf">roles_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de roles por fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Gestionar roles de fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de los roles de la fase previamente seleccionada.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">Rol</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fase__id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;roles&#39;</span><span class="p">:</span><span class="n">roles</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/roles_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="fase_agregar_rol_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.fase_agregar_rol_view">[docs]</a><span class="k">def</span> <span class="nf">fase_agregar_rol_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de roles del proyecto ligado a la fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar todos los roles del proyecto al cual esta ligada la fase, ademas, el template relacionado concede </span>
<span class="sd">        las opciones para agregar un rol seleccionado.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;roles&#39;</span><span class="p">:</span><span class="n">roles</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/agregar_rol.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Agregar rol a fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="fase_confirmacion_agregar_rol_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.fase_confirmacion_agregar_rol_view">[docs]</a><span class="k">def</span> <span class="nf">fase_confirmacion_agregar_rol_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_rol</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista de confirmacion de agregacion de un rol a una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Agregar rol a fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario agregar un rol seleccionado a la fase seleccionada previamente. Se verifica si el rol a agregar ya </span>
<span class="sd">        pertenece a la fase, en cuyo caso se cancelara la operacion.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_rol: el identificador del rol.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">rol</span> <span class="o">=</span> <span class="n">Rol</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_rol</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_rol</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Rol</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>      
    <span class="k">if</span> <span class="n">valido</span><span class="p">:</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rol</span><span class="p">)</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;rol&#39;</span><span class="p">:</span><span class="n">rol</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/confirmacion_agregar_rol.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>  
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Quitar rol de fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="fase_quitar_rol_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.fase_quitar_rol_view">[docs]</a><span class="k">def</span> <span class="nf">fase_quitar_rol_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_rol</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para quitar un rol de una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Quitar rol de fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">        </span>
<span class="sd">        Esta vista permite al usuario quitar un rol seleccionado de la fase seleccionada previamente.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_rol: el identificador del rol.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">rol</span> <span class="o">=</span> <span class="n">Rol</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_rol</span><span class="p">)</span>
    <span class="n">fase</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rol</span><span class="p">)</span>
    <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;rol&#39;</span><span class="p">:</span><span class="n">rol</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/quitar_rol.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar tipos de item de fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="tipos_item_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.tipos_item_fase_view">[docs]</a><span class="k">def</span> <span class="nf">tipos_item_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de tipos de item del sistema. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">                - El usuario debe estar logueado.</span>
<span class="sd">                - El usuario debe poseer el permiso: Gestionar tipos de item de fase.</span>
<span class="sd">                - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">                </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de los tipos de item del sistema.</span>
<span class="sd">        Inicialmente, se verifican los permisos del usuario solicitante para restringir (si es necesario) </span>
<span class="sd">        los botones de accion sobre cada tipo de item.</span>
<span class="sd">                </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">                - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">                - id_fase: el identificador de la fase.</span>
<span class="sd">                - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">                - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">crear_tipo_de_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">modificar_tipo_de_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">eliminar_tipo_de_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">visualizar_tipo_de_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_tipos_de_atributo</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Crear tipo de item&#39;</span><span class="p">:</span>
                <span class="n">crear_tipo_de_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Modificar tipo de item&#39;</span><span class="p">:</span>
                <span class="n">modificar_tipo_de_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Eliminar tipo de item&#39;</span><span class="p">:</span>
                <span class="n">eliminar_tipo_de_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Visualizar tipo de item&#39;</span><span class="p">:</span>
                <span class="n">visualizar_tipo_de_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar tipos de atributo de tipo de item&#39;</span><span class="p">:</span>
                <span class="n">gestionar_tipos_de_atributo</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="k">if</span> <span class="n">crear_tipo_de_item</span> <span class="ow">and</span> <span class="n">modificar_tipo_de_item</span> <span class="ow">and</span> <span class="n">eliminar_tipo_de_item</span> <span class="ow">and</span> <span class="n">visualizar_tipo_de_item</span> <span class="ow">and</span> <span class="n">gestionar_tipos_de_atributo</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">crear_tipo_de_item</span> <span class="ow">and</span> <span class="n">modificar_tipo_de_item</span> <span class="ow">and</span> <span class="n">eliminar_tipo_de_item</span> <span class="ow">and</span> <span class="n">visualizar_tipo_de_item</span> <span class="ow">and</span> <span class="n">gestionar_tipos_de_atributo</span><span class="p">:</span>
                <span class="k">break</span>
            
    <span class="n">tipos_item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipos_item&#39;</span><span class="p">:</span><span class="n">tipos_item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;crear_tipo_de_item&#39;</span><span class="p">:</span><span class="n">crear_tipo_de_item</span><span class="p">,</span> <span class="s">&#39;modificar_tipo_de_item&#39;</span><span class="p">:</span><span class="n">modificar_tipo_de_item</span><span class="p">,</span> <span class="s">&#39;eliminar_tipo_de_item&#39;</span><span class="p">:</span><span class="n">eliminar_tipo_de_item</span><span class="p">,</span> <span class="s">&#39;visualizar_tipo_de_item&#39;</span><span class="p">:</span><span class="n">visualizar_tipo_de_item</span><span class="p">,</span> <span class="s">&#39;gestionar_tipos_de_atributo&#39;</span><span class="p">:</span><span class="n">gestionar_tipos_de_atributo</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/gestion_tipos_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
  </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Crear tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="crear_tipo_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.crear_tipo_item_view">[docs]</a><span class="k">def</span> <span class="nf">crear_tipo_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para crear un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Crear tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario crear un tipo de item para lograr esto, se verifica la validez de cada campo ingresado y </span>
<span class="sd">        luego se crea el tipo de item de acuerdo a los campos ingresados. </span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de usuarios. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">CrearTipoItemForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CrearTipoItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            
            <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">)</span>
            <span class="n">tipo_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tipo_item</span><span class="p">)</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/tipos_item/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/crear_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/crear_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Modificar tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="modificar_tipo_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.modificar_tipo_item_view">[docs]</a><span class="k">def</span> <span class="nf">modificar_tipo_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para modificar un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Modificar tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario modificar un tipo de item previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica la validez de cada campo modificado y luego se guarda el tipo de item de acuerdo a los campos ingresados.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template de visualizacion de la fase modificada. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarTipoItemForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            
            <span class="n">tipo_item</span><span class="o">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span>
            <span class="n">tipo_item</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="n">descripcion</span>

            <span class="n">tipo_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/tipos_item/tipo_item/</span><span class="si">%s</span><span class="s">/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tipo_item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarTipoItemForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="p">{</span>
            <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">tipo_item</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
            <span class="s">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">tipo_item</span><span class="o">.</span><span class="n">descripcion</span><span class="p">,</span>
            <span class="p">})</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s">&#39;tipo_item&#39;</span><span class="p">:</span> <span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/modificar_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
  </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Visualizar tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="visualizar_tipo_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.visualizar_tipo_item_view">[docs]</a><span class="k">def</span> <span class="nf">visualizar_tipo_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para visualizar un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Visualizar tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario visualizar todos los campos guardados de un tipo de item previamente seleccionado.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span> <span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/visualizar_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Eliminar tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="eliminar_tipo_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.eliminar_tipo_item_view">[docs]</a><span class="k">def</span> <span class="nf">eliminar_tipo_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para eliminar un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Eliminar tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario eliminar un tipo de item previamente seleccionado.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o no se cumplieron las condiciones para eliminar, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de fases. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">tipo_item</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/tipos_item/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span><span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/eliminar_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar tipos de atributo de tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="tipos_atributo_tipo_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.tipos_atributo_tipo_item_view">[docs]</a><span class="k">def</span> <span class="nf">tipos_atributo_tipo_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de tipos de atributo del tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Gestionar tipos de atributo de tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de los tipos de atributo del item previamente seleccionado.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">tipos_atributo</span> <span class="o">=</span> <span class="n">TipoAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipoitem__id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span><span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;tipos_atributo&#39;</span><span class="p">:</span><span class="n">tipos_atributo</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/tipos_atributo_tipo_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="agregar_tipo_atributo_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.agregar_tipo_atributo_view">[docs]</a><span class="k">def</span> <span class="nf">agregar_tipo_atributo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de tipos de atributo ligados al tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar todos los tipos de atributo del sistema, ademas, el template relacionado concede </span>
<span class="sd">        las opciones para agregar un tipo de atributo seleccionado.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_fase: el identificador del la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">tipos_atributo</span> <span class="o">=</span> <span class="n">TipoAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span><span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;tipos_atributo&#39;</span><span class="p">:</span><span class="n">tipos_atributo</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/agregar_tipo_atributo.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Agregar tipo de atributo a tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="confirmacion_agregar_tipo_atributo_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.confirmacion_agregar_tipo_atributo_view">[docs]</a><span class="k">def</span> <span class="nf">confirmacion_agregar_tipo_atributo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_atributo</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista de confirmacion de agregacion de un tipo de atributo a un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Agregar tipo de atributo a tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario agregar un tipo de atributo seleccionado a el tipo de item seleccionado previamente. Se verifica si el tipo de atributo a agregar ya </span>
<span class="sd">        pertenece al tipo de item, en cuyo caso se cancelara la operacion.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador del tipo de item.</span>
<span class="sd">            - id_tipo_atributo: el identificador del tipo de atributo.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">tipo_atributo</span> <span class="o">=</span> <span class="n">TipoAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_atributo</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tipo_atribut</span> <span class="o">=</span> <span class="n">tipo_item</span><span class="o">.</span><span class="n">tipos_atributo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_atributo</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TipoAtributo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>      
    <span class="k">if</span> <span class="n">valido</span><span class="p">:</span>
        <span class="n">tipo_item</span><span class="o">.</span><span class="n">tipos_atributo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tipo_atributo</span><span class="p">)</span>
        <span class="n">tipo_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span><span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;tipo_atributo&#39;</span><span class="p">:</span><span class="n">tipo_atributo</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/confirmacion_agregar_tipo_atributo.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Quitar tipo de atributo de tipo de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="quitar_tipo_atributo_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.quitar_tipo_atributo_view">[docs]</a><span class="k">def</span> <span class="nf">quitar_tipo_atributo_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_tipo_atributo</span><span class="p">,</span> <span class="n">id_tipo_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para quitar un tipo de atributo de un tipo de item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Quitar tipo de atributo de tipo de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">        </span>
<span class="sd">        Esta vista permite al usuario quitar un tipo de atributo seleccionado del tipo de item seleccionado previamente.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_tipo_item: el identificador de la tipo de item.</span>
<span class="sd">            - id_tipo_atributo: el identificador del tipo de atributo.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">proyecto</span>
    <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
    <span class="n">tipo_atributo</span> <span class="o">=</span> <span class="n">TipoAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_atributo</span><span class="p">)</span>
    <span class="n">atributos</span> <span class="o">=</span> <span class="n">ValorAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tipo_atributo__id</span><span class="o">=</span><span class="n">id_tipo_atributo</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">atributos</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">valido</span><span class="p">:</span>
        <span class="n">tipo_item</span><span class="o">.</span><span class="n">tipos_atributo</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tipo_atributo</span><span class="p">)</span>
        <span class="n">tipo_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tipo_item&#39;</span><span class="p">:</span><span class="n">tipo_item</span><span class="p">,</span> <span class="s">&#39;tipo_atributo&#39;</span><span class="p">:</span><span class="n">tipo_atributo</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;tipo_item/quitar_tipo_atributo.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Iniciar fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="iniciar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.iniciar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">iniciar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para iniciar una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Iniciar fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario iniciar una fase si es que cumple con las siguientes condiciones:</span>
<span class="sd">        </span>
<span class="sd">            - Debe estar en estado Inactivo.</span>
<span class="sd">            - Debe poseer al menos un rol.</span>
<span class="sd">            - Debe poseer al menos un tipo de item.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">inicio_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">roles_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">tipos_item_valido</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">inicio_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tipos_item_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">inicio_valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">roles_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">inicio_valido</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">if</span> <span class="n">inicio_valido</span><span class="p">:</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;inicio_valido&#39;</span><span class="p">:</span><span class="n">inicio_valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;tipos_item_valido&#39;</span><span class="p">:</span><span class="n">tipos_item_valido</span><span class="p">,</span> <span class="s">&#39;roles_valido&#39;</span><span class="p">:</span><span class="n">roles_valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/iniciar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;inicio_valido&#39;</span><span class="p">:</span><span class="n">inicio_valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;tipos_item_valido&#39;</span><span class="p">:</span><span class="n">tipos_item_valido</span><span class="p">,</span> <span class="s">&#39;roles_valido&#39;</span><span class="p">:</span><span class="n">roles_valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/iniciar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    </div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Finalizar fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="finalizar_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.finalizar_fase_view">[docs]</a><span class="k">def</span> <span class="nf">finalizar_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para finalizar una fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Finalizar fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario finalizar una fase si es que cumple con las siguientes condiciones:</span>
<span class="sd">        </span>
<span class="sd">            - Debe estar en estado En curso.</span>
<span class="sd">            - Todos sus items deben estar en estado Bloqueado.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">finalizado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">finalizado_valido</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="k">if</span> <span class="n">estado_valido</span><span class="p">:</span>
        <span class="n">finalizado_valido</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">estado</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">finalizado_valido</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
            
        <span class="k">if</span> <span class="n">finalizado_valido</span><span class="p">:</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;finalizado_valido&#39;</span><span class="p">:</span><span class="n">finalizado_valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/finalizar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;finalizado_valido&#39;</span><span class="p">:</span><span class="n">finalizado_valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/finalizar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;finalizado_valido&#39;</span><span class="p">:</span><span class="n">finalizado_valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/finalizar_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar items de fase&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="items_fase_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.items_fase_view">[docs]</a><span class="k">def</span> <span class="nf">items_fase_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de items por fase. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Gestionar items de fase.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de desarrollo de los items de la fase seleccionada.</span>
<span class="sd">        Inicialmente, se verifican los permisos del usuario solicitante para restringir (si es necesario) </span>
<span class="sd">        los botones de accion sobre cada item.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crear_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">modificar_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">eliminar_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">visualizar_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gestionar_relaciones</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">aprobar_item</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">permisos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Crear item&#39;</span><span class="p">:</span>
                <span class="n">crear_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Modificar item&#39;</span><span class="p">:</span>
                <span class="n">modificar_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Eliminar item&#39;</span><span class="p">:</span>
                <span class="n">eliminar_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Visualizar item&#39;</span><span class="p">:</span>
                <span class="n">visualizar_item</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Gestionar relaciones de item&#39;</span><span class="p">:</span>
                <span class="n">gestionar_relaciones</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#39;Aprobar item&#39;</span><span class="p">:</span>
                <span class="n">aprobar_item</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="k">if</span> <span class="n">crear_item</span> <span class="ow">and</span> <span class="n">modificar_item</span> <span class="ow">and</span> <span class="n">eliminar_item</span> <span class="ow">and</span> <span class="n">visualizar_item</span> <span class="ow">and</span> <span class="n">gestionar_relaciones</span> <span class="ow">and</span> <span class="n">aprobar_item</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">crear_item</span> <span class="ow">and</span> <span class="n">modificar_item</span> <span class="ow">and</span> <span class="n">eliminar_item</span> <span class="ow">and</span> <span class="n">visualizar_item</span> <span class="ow">and</span> <span class="n">gestionar_relaciones</span> <span class="ow">and</span> <span class="n">aprobar_item</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;items&#39;</span><span class="p">:</span><span class="n">items</span><span class="p">,</span> <span class="s">&#39;crear_item&#39;</span><span class="p">:</span><span class="n">crear_item</span><span class="p">,</span> <span class="s">&#39;modificar_item&#39;</span><span class="p">:</span><span class="n">modificar_item</span><span class="p">,</span> <span class="s">&#39;eliminar_item&#39;</span><span class="p">:</span><span class="n">eliminar_item</span><span class="p">,</span> <span class="s">&#39;visualizar_item&#39;</span><span class="p">:</span><span class="n">visualizar_item</span><span class="p">,</span> <span class="s">&#39;gestionar_relaciones&#39;</span><span class="p">:</span><span class="n">gestionar_relaciones</span><span class="p">,</span> <span class="s">&#39;aprobar_item&#39;</span><span class="p">:</span><span class="n">aprobar_item</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;fase/items_fase.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Crear item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="crear_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.crear_item_view">[docs]</a><span class="k">def</span> <span class="nf">crear_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para crear un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Crear item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario crear y agregar un item a la fase previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica la validez de cada campo ingresado y luego se crea el item de acuerdo a los campos ingresados y </span>
<span class="sd">        se almacena en la fase. </span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de items por fase. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">tipos_item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">tipos_item</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">form</span> <span class="o">=</span> <span class="n">CrearItemForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CrearItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            <span class="n">complejidad</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;complejidad&#39;</span><span class="p">]</span>
            <span class="n">costo_monetario</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;costo_monetario&#39;</span><span class="p">]</span>
            <span class="n">costo_temporal</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;costo_temporal&#39;</span><span class="p">]</span>
            
            <span class="n">id_tipo_item</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;tipo_item&#39;</span><span class="p">)</span>
            
            <span class="n">tipo_item</span> <span class="o">=</span> <span class="n">TipoItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_tipo_item</span><span class="p">)</span>
            
            <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">,</span> <span class="n">complejidad</span><span class="o">=</span><span class="n">complejidad</span><span class="p">,</span> <span class="n">costo_monetario</span><span class="o">=</span><span class="n">costo_monetario</span><span class="p">,</span> <span class="n">costo_temporal</span><span class="o">=</span><span class="n">costo_temporal</span><span class="p">,</span> <span class="n">tipo_item</span><span class="o">=</span><span class="n">tipo_item</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">version_item</span> <span class="o">=</span> <span class="n">VersionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">id_item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">,</span> <span class="n">complejidad</span><span class="o">=</span><span class="n">complejidad</span><span class="p">,</span> <span class="n">costo_monetario</span><span class="o">=</span><span class="n">costo_monetario</span><span class="p">,</span> <span class="n">costo_temporal</span><span class="o">=</span><span class="n">costo_temporal</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">fase</span><span class="p">,</span> <span class="n">tipo_item</span><span class="o">=</span><span class="n">tipo_item</span><span class="p">,</span> <span class="n">fecha_version</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
            <span class="n">version_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">tipos_atributo</span> <span class="o">=</span> <span class="n">tipo_item</span><span class="o">.</span><span class="n">tipos_atributo</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tipo_atributo</span> <span class="ow">in</span> <span class="n">tipos_atributo</span><span class="p">:</span>
                <span class="n">valor_atributo</span> <span class="o">=</span> <span class="n">ValorAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">tipo_item</span><span class="o">=</span><span class="n">tipo_item</span><span class="p">,</span> <span class="n">tipo_atributo</span><span class="o">=</span><span class="n">tipo_atributo</span><span class="p">)</span>
                <span class="n">valor_atributo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">fase</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/items/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;tipos_item&#39;</span><span class="p">:</span><span class="n">tipos_item</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;crear_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;tipos_item&#39;</span><span class="p">:</span><span class="n">tipos_item</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/crear_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Modificar item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="modificar_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.modificar_item_view">[docs]</a><span class="k">def</span> <span class="nf">modificar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para modificar un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Modificar item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario modificar un item de la fase previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica la validez de cada campo modificado y luego se guarda el item de acuerdo a los campos ingresados.</span>
<span class="sd">    </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:    </span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o el formulario resulto invalido, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template de visualizacion del item modificado. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">atributos</span> <span class="o">=</span> <span class="n">ValorAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item__id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarItemForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarItemForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;nombre&#39;</span><span class="p">]</span>
            <span class="n">descripcion</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;descripcion&#39;</span><span class="p">]</span>
            <span class="n">complejidad</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;complejidad&#39;</span><span class="p">]</span>
            <span class="n">costo_monetario</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;costo_monetario&#39;</span><span class="p">]</span>
            <span class="n">costo_temporal</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;costo_temporal&#39;</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atributos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">tipo_atributo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">tipo_atributo</span><span class="o">.</span><span class="n">tipo_dato</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">valor_numerico</span> <span class="o">=</span> <span class="n">value</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">tipo_atributo</span><span class="o">.</span><span class="n">tipo_dato</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">valor_fecha</span> <span class="o">=</span> <span class="n">value</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">tipo_atributo</span><span class="o">.</span><span class="n">tipo_dato</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">valor_texto</span> <span class="o">=</span> <span class="n">value</span>
                            <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;1&quot;</span><span class="p">:</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">valor_logico</span> <span class="o">=</span> <span class="bp">None</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                            <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;2&quot;</span><span class="p">:</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">valor_logico</span> <span class="o">=</span> <span class="bp">True</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                            <span class="k">elif</span> <span class="n">value</span><span class="o">==</span><span class="s">&quot;3&quot;</span><span class="p">:</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">valor_logico</span> <span class="o">=</span> <span class="bp">False</span>
                                <span class="n">a</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                        
            <span class="n">item</span><span class="o">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span>
            <span class="n">item</span><span class="o">.</span><span class="n">descripcion</span> <span class="o">=</span> <span class="n">descripcion</span>
            <span class="n">item</span><span class="o">.</span><span class="n">complejidad</span> <span class="o">=</span> <span class="n">complejidad</span>
            <span class="n">item</span><span class="o">.</span><span class="n">costo_monetario</span> <span class="o">=</span> <span class="n">costo_monetario</span>
            <span class="n">item</span><span class="o">.</span><span class="n">costo_temporal</span> <span class="o">=</span> <span class="n">costo_temporal</span>
            <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">VersionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id_item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-fecha_version&#39;</span><span class="p">)[:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">version_item</span> <span class="o">=</span> <span class="n">VersionItem</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">id_item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">nombre</span><span class="o">=</span><span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span><span class="o">=</span><span class="n">descripcion</span><span class="p">,</span> <span class="n">complejidad</span><span class="o">=</span><span class="n">complejidad</span><span class="p">,</span> <span class="n">costo_monetario</span><span class="o">=</span><span class="n">costo_monetario</span><span class="p">,</span> <span class="n">costo_temporal</span><span class="o">=</span><span class="n">costo_temporal</span><span class="p">,</span> <span class="n">fase</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">fase</span><span class="p">,</span> <span class="n">tipo_item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">tipo_item</span><span class="p">,</span> <span class="n">fecha_version</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
            <span class="n">version_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/items/item/</span><span class="si">%s</span><span class="s">/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ModificarItemForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="p">{</span>
            <span class="s">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
            <span class="s">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">descripcion</span><span class="p">,</span>
            <span class="s">&#39;costo_temporal&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">costo_temporal</span><span class="p">,</span>
            <span class="s">&#39;costo_monetario&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">costo_monetario</span><span class="p">,</span>
            <span class="s">&#39;complejidad&#39;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">complejidad</span><span class="p">,</span>
            <span class="p">})</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;form&#39;</span><span class="p">:</span><span class="n">form</span><span class="p">,</span> <span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;atributos&#39;</span><span class="p">:</span><span class="n">atributos</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/modificar_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Eliminar item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="eliminar_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.eliminar_item_view">[docs]</a><span class="k">def</span> <span class="nf">eliminar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para eliminar un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Eliminar item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario eliminar un item de la fase previamente seleccionada, para lograr esto, </span>
<span class="sd">        se verifica si el item cumple las siguientes condiciones:</span>
<span class="sd">        </span>
<span class="sd">            - El item debe estar en estado En construccion o En revision.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: si la operacion resulto ser de tipo GET o no se cumplieron las condiciones para eliminar, devuelve el contexto, </span>
<span class="sd">            generado en la vista, al template correspondiente.</span>
<span class="sd">            - HttpResponseRedirect: si la operacion resulto valida, se redirige al template del listado de items por fase. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">atributos</span> <span class="o">=</span> <span class="n">ValorAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item__id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valido</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/desarrollo/fases/items/fase/</span><span class="si">%s</span><span class="s">/proyecto/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">id_fase</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;atributos&#39;</span><span class="p">:</span><span class="n">atributos</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/eliminar_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;atributos&#39;</span><span class="p">:</span><span class="n">atributos</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/eliminar_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Visualizar item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="visualizar_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.visualizar_item_view">[docs]</a><span class="k">def</span> <span class="nf">visualizar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para visualizar un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Visualizar item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">    </span>
<span class="sd">        Esta vista permite al usuario visualizar todos los campos guardados de un item de la fase previamente seleccionada.</span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">atributos</span> <span class="o">=</span> <span class="n">ValorAtributo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">item__id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">Fase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span> <span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;atributos&#39;</span><span class="p">:</span><span class="n">atributos</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/visualizar_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Aprobar item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="aprobar_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.aprobar_item_view">[docs]</a><span class="k">def</span> <span class="nf">aprobar_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para aprobar un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Aprobar item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">    </span>
<span class="sd">        Esta vista permite al usuario aprobar un item, es decir, cambiar el estado del item a Aprobado. Para lograr esto, el</span>
<span class="sd">        item debe estar en estado En Construccion o En Revision.</span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">    </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">valido</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/aprobar_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Gestionar relaciones de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="relaciones_item_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.relaciones_item_view">[docs]</a><span class="k">def</span> <span class="nf">relaciones_item_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de relaciones por item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">        </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Gestionar relaciones de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">            </span>
<span class="sd">        Esta vista permite al usuario listar y conocer las opciones de las relaciones del item seleccionado.</span>
<span class="sd">            </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_fase: el identificador de la fase.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relaciones</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;relaciones&#39;</span><span class="p">:</span><span class="n">relaciones</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/relaciones_item.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="agregar_relacion_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.agregar_relacion_view">[docs]</a><span class="k">def</span> <span class="nf">agregar_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista del listado de items pertenecientes a la fase siguiente o la misma fase. La eleccion de una de las anteriores dependera</span>
<span class="sd">        del tipo de relacion que se quiera agregar (Padre-Hijo o Antecesor-Sucesor). Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">        </span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador del la fase.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">valido</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">valido</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">eleccion_relacion</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;eleccion_relacion&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eleccion_relacion</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
            <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">padre</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">:</span>
                <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">items_hijos</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">:</span>
                <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">items_hijos</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">)</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;items_hijos&#39;</span><span class="p">:</span><span class="n">items_hijos</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/agregar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">eleccion_relacion</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">num_fases_valido</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">estado</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">estado_valido</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">num_fases</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">&lt;</span> <span class="n">num_fases</span><span class="p">:</span>
                <span class="n">num_fases_valido</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">estado_valido</span> <span class="ow">and</span> <span class="n">num_fases_valido</span><span class="p">:</span>
                <span class="n">fase_vecina</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num_secuencia</span> <span class="o">=</span> <span class="p">(</span><span class="n">fase</span><span class="o">.</span><span class="n">num_secuencia</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">items_sucesores</span> <span class="o">=</span> <span class="n">fase_vecina</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">padre</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;items_sucesores&#39;</span><span class="p">:</span><span class="n">items_sucesores</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;fase_vecina&#39;</span><span class="p">:</span><span class="n">fase_vecina</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
                <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/agregar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">,</span> <span class="s">&#39;estado_valido&#39;</span><span class="p">:</span><span class="n">estado_valido</span><span class="p">,</span> <span class="s">&#39;num_fases_valido&#39;</span><span class="p">:</span><span class="n">num_fases_valido</span><span class="p">}</span>
                <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/agregar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

    <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">padre</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">:</span>
        <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">items_hijos</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">:</span>
        <span class="n">items_hijos</span> <span class="o">=</span> <span class="n">items_hijos</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;items_hijos&#39;</span><span class="p">:</span><span class="n">items_hijos</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">,</span> <span class="s">&#39;valido&#39;</span><span class="p">:</span><span class="n">valido</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/agregar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Agregar relacion a item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="confirmacion_agregar_relacion_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.confirmacion_agregar_relacion_view">[docs]</a><span class="k">def</span> <span class="nf">confirmacion_agregar_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_relacion</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista de la confirmacion de agregacion de una relacion a un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Agregar relacion a item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">        </span>
<span class="sd">        Esta funcionalidad se encarga de realizar la agregacion de relacion. No posee excepciones, puesto que, los items a seleccionar para</span>
<span class="sd">        la agregacion cumplen con todos los requisitos necesarios para evitar inconsistencias en el grafo de items relacionados.</span>
<span class="sd">        La vista recibe los siguientes parametros:</span>
<span class="sd">        </span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador del la fase.</span>
<span class="sd">            - id_relacion: el identificador del item a relacionar.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_relacion</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">fase</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">relacion</span><span class="o">.</span><span class="n">fase</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
            
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span>
            
        <span class="n">relacion</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
            
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">adan</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span><span class="p">:</span>
            <span class="n">relacion</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">cain</span>
        
        <span class="n">relacion</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="n">item</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">relacion</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span><span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/confirmacion_agregar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</div>
<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/login/&#39;</span><span class="p">)</span>
<span class="nd">@permiso_requerido</span><span class="p">(</span><span class="n">permiso</span><span class="o">=</span><span class="s">&quot;Quitar relacion de item&quot;</span><span class="p">)</span>
<span class="nd">@fase_miembro_proyecto</span><span class="p">()</span>
<div class="viewcode-block" id="quitar_relacion_view"><a class="viewcode-back" href="../../moduloDES/views.html#desarrollo.views.quitar_relacion_view">[docs]</a><span class="k">def</span> <span class="nf">quitar_relacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">id_fase</span><span class="p">,</span> <span class="n">id_item</span><span class="p">,</span> <span class="n">id_relacion</span><span class="p">,</span> <span class="n">id_proyecto</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ::</span>
<span class="sd">    </span>
<span class="sd">        La vista para quitar una relacion de un item. Para acceder a esta vista se deben cumplir los siguientes</span>
<span class="sd">        requisitos:</span>
<span class="sd">    </span>
<span class="sd">            - El usuario debe estar logueado.</span>
<span class="sd">            - El usuario debe poseer el permiso: Quitar relacion de item.</span>
<span class="sd">            - El usuario debe ser miembro del proyecto al cual esta ligada la fase.</span>
<span class="sd">        </span>
<span class="sd">        Esta funcionalidad permite a un usuario romper una relacion entre el padre/antecesor item y un hijo hijo/sucesor. Ademas de esto, </span>
<span class="sd">        todos aquellos items hijos/sucesores del item hijo/sucesor en cuestion pasan a cambiar el valor de su padre raiz por el identificador</span>
<span class="sd">        del item hijo/sucesor en cuestion.</span>
<span class="sd">            - request: contiene informacion sobre la sesion actual.</span>
<span class="sd">            - id_item: el identificador del item.</span>
<span class="sd">            - id_fase: el identificador del la fase.</span>
<span class="sd">            - id_relacion: el identificador del item a relacionar.</span>
<span class="sd">            - id_proyecto: el identificador del proyecto.</span>
<span class="sd">            </span>
<span class="sd">        La vista retorna lo siguiente:</span>
<span class="sd">        </span>
<span class="sd">            - render_to_response: devuelve el contexto, generado en la vista, al template correspondiente. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_proyecto</span><span class="p">)</span>
    <span class="n">fase</span> <span class="o">=</span> <span class="n">proyecto</span><span class="o">.</span><span class="n">fases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_fase</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">fase</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_item</span><span class="p">)</span>
    <span class="n">relacion</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_relacion</span><span class="p">)</span>
    
    <span class="n">relacion</span><span class="o">.</span><span class="n">padre_raiz</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">padre</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">tipo_relacion</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">relacion</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    
    <span class="n">relaciones</span> <span class="o">=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relaciones</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">id</span>
        <span class="n">r</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">hijos</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nuevas_relaciones</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hijos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hijos</span><span class="p">:</span>
                <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">relaciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">nuevas_relaciones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">hijos</span> <span class="o">=</span> <span class="n">nuevas_relaciones</span>
        
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">resultados</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">adan</span> <span class="o">=</span> <span class="n">relacion</span><span class="o">.</span><span class="n">id</span>
            <span class="n">h</span><span class="o">.</span><span class="n">cain</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span>
            <span class="n">h</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            
    <span class="n">ctx</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;item&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;relacion&#39;</span><span class="p">:</span><span class="n">relacion</span><span class="p">,</span> <span class="s">&#39;fase&#39;</span><span class="p">:</span><span class="n">fase</span><span class="p">,</span> <span class="s">&#39;proyecto&#39;</span><span class="p">:</span><span class="n">proyecto</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;item/quitar_relacion.html&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2014, Rodrigo Santos | Gustavo Cabral.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>
